<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Экстренные службы и напоминания</title>
<style>
body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
.panel { background: #fff; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
button { margin: 5px 0; padding: 10px 15px; cursor: pointer; }
.status { color: #555; font-size: 0.9em; }
.badge { display: inline-block; padding: 2px 6px; border-radius: 6px; font-size: 12px; background: #eee; margin-left: 6px; }
.badge.on { background: #dff6dd; color: #1a7f37; }
.badge.off { background: #ffe2e2; color: #a40000; }
#recognized { display: block; margin-top: 8px; color: #333; }
#reminderList { margin-top: 10px; }
.reminder-item { display:flex; justify-content:space-between; padding:6px 8px; border-radius:6px; background:#fafafa; margin-bottom:6px; align-items:center; }
.reminder-text { margin-left:8px; flex:1; }
.small { font-size:0.85em; color:#666; }
</style>
</head>
<body>

<h1 data-i18n="title">Экстренные службы и напоминания</h1>

<div class="panel">
  <label data-i18n="choose_language">Язык (ru, en, uk, hu, fr): </label>
  <input type="text" id="langInput" value="ru">
  <button id="startBtn" onclick="startApp()" data-i18n="start">Начать</button>
</div>

<div class="panel">
  <strong data-i18n="status_label">Статус:</strong> <span id="status" data-i18n="status_not_started">Не начато</span>
</div>

<div class="panel">
  <strong data-i18n="weather_label">Погода:</strong> <span id="weather">---</span>
</div>

<div class="panel">
  <strong data-i18n="reminders_label">Напоминания:</strong>
  <div id="reminderList"><span class="small">---</span></div>
  <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
    <input type="time" id="reminderTime" style="min-width:110px;">
    <input type="text" id="reminderText" placeholder="Текст напоминания" style="flex:1;">
    <button onclick="addReminder()" data-i18n="add_reminder">Добавить</button>
  </div>
</div>

<div class="panel">
  <strong data-i18n="emergency_actions">Экстренные действия:</strong><br>
  <button onclick="alert('Проверка звука')" data-i18n="check_sound">Проверить звук</button>
  <button onclick="alert('Вызов полиции')" data-i18n="police">Полиция</button>
  <button onclick="alert('Вызов пожарной')" data-i18n="fire">Пожарная</button>
  <button onclick="alert('Вызов скорой')" data-i18n="ambulance">Скорая</button>
</div>

<div class="panel">
  <strong data-i18n="voice_control">Голосовое управление</strong>
  <span id="micState" class="badge off">микрофон: выкл</span>
  <div class="status" id="voiceHints" data-i18n="voice_examples">Пример команд: "начать", "язык ru", "погода", "полиция", "напомни в 15:30 позвонить маме"</div>
  <button id="micToggle">Включить микрофон</button>
  <span id="recognized">---</span>
</div>

<script>
// -------------------
let langCode = "ru";
let reminders = [];
let lastCoords = null;
let countryName = "Неизвестно";
let recognition = null;
let isListening = false;

// i18n
const i18n = {
  ru:{title:"Экстренные службы и напоминания", choose_language:"Язык (ru, en, uk, hu, fr): ", start:"Начать", status_label:"Статус:", status_not_started:"Не начато", weather_label:"Погода:", reminders_label:"Напоминания:", add_reminder:"Добавить", emergency_actions:"Экстренные действия:", check_sound:"Проверить звук", police:"Полиция", fire:"Пожарная", ambulance:"Скорая", voice_control:"Голосовое управление", voice_examples:'Пример команд: "начать", "язык ru", "погода", "полиция", "напомни в 15:30 позвонить маме"', mic_on:"микрофон: вкл", mic_off:"микрофон: выкл", mic_btn_on:"Выключить микрофон", mic_btn_off:"Включить микрофон", browser_no_stt:"Ваш браузер не поддерживает распознавание речи.", recognized_prefix:"Распознано:"},
  en:{title:"Emergency services and reminders", choose_language:"Language (ru, en, uk, hu, fr): ", start:"Start", status_label:"Status:", status_not_started:"Not started", weather_label:"Weather:", reminders_label:"Reminders:", add_reminder:"Add", emergency_actions:"Emergency actions:", check_sound:"Check sound", police:"Police", fire:"Fire", ambulance:"Ambulance", voice_control:"Voice control", voice_examples:'Example: "start", "language en", "weather", "police", "remind at 15:30 call mom"', mic_on:"microphone: on", mic_off:"microphone: off", mic_btn_on:"Turn off mic", mic_btn_off:"Turn on mic", browser_no_stt:"Your browser does not support speech recognition.", recognized_prefix:"Recognized:"},
  uk:{title:"Екстрені служби та нагадування", choose_language:"Мова (ru, en, uk, hu, fr): ", start:"Почати", status_label:"Статус:", status_not_started:"Не розпочато", weather_label:"Погода:", reminders_label:"Нагадування:", add_reminder:"Додати", emergency_actions:"Екстрені дії:", check_sound:"Перевірити звук", police:"Поліція", fire:"Пожежна", ambulance:"Швидка", voice_control:"Голосове керування", voice_examples:'Приклад: "почати", "мова uk", "погода", "поліція", "нагадай о 15:30 зателефонувати мамі"', mic_on:"мікрофон: увімк", mic_off:"мікрофон: вимк", mic_btn_on:"Вимкнути мікрофон", mic_btn_off:"Увімкнути мікрофон", browser_no_stt:"Ваш браузер не підтримує розпізнавання мовлення.", recognized_prefix:"Розпізнано:"},
  hu:{title:"Segélyhívás és emlékeztetők", choose_language:"Nyelv (ru, en, uk, hu, fr): ", start:"Indítás", status_label:"Állapot:", status_not_started:"Nincs elindítva", weather_label:"Időjárás:", reminders_label:"Emlékeztetők:", add_reminder:"Hozzáadás", emergency_actions:"Vészhelyzeti műveletek:", check_sound:"Hang ellenőrzése", police:"Rendőrség", fire:"Tűzoltóság", ambulance:"Mentő", voice_control:"Hangvezérlés", voice_examples:'Példa: "indítás", "nyelv hu", "időjárás", "rendőrség", "emlékeztess 15:30-kor, hogy felhívjam anyut"', mic_on:"mikrofon: be", mic_off:"mikrofon: ki", mic_btn_on:"Mikrofon kikapcsolása", mic_btn_off:"Mikrofon bekapcsolása", browser_no_stt:"A böngésződ nem támogatja a beszédfelismerést.", recognized_prefix:"Felismerve:"},
  fr:{title:"Services d'urgence et rappels", choose_language:"Langue (ru, en, uk, hu, fr): ", start:"Démarrer", status_label:"Statut:", status_not_started:"Non démarré", weather_label:"Météo:", reminders_label:"Rappels:", add_reminder:"Ajouter", emergency_actions:"Actions d'urgence:", check_sound:"Vérifier le son", police:"Police", fire:"Pompiers", ambulance:"Ambulance", voice_control:"Commande vocale", voice_examples:'Exemple: "démarrer", "langue fr", "météo", "police", "rappelle à 15:30 d\'appeler maman"', mic_on:"micro: activé", mic_off:"micro: désactivé", mic_btn_on:"Désactiver le micro", mic_btn_off:"Activer le micro", browser_no_stt:"Votre navigateur ne prend pas en charge la reconnaissance vocale.", recognized_prefix:"Reconnu:"}
};

// -------------------
const countryAliases = {
  "russia": {"ru":"Россия","en":"Russia","uk":"Росія","hu":"Oroszország","fr":"Russie"},
  "ukraine": {"ru":"Украина","en":"Ukraine","uk":"Україна","hu":"Ukrajna","fr":"Ukraine"},
  "hungary": {"ru":"Венгрия","en":"Hungary","uk":"Угорщина","hu":"Magyarország","fr":"Hongrie"},
  "france": {"ru":"Франция","en":"France","uk":"Франція","hu":"Franciaország","fr":"France"}
};

function tt(key){return i18n[langCode][key]||key;}

function translateCountry(name){if(!name) return tt("status_not_started"); const key=name.toLowerCase(); return countryAliases[key]?countryAliases[key][langCode]||name:name;}

// -------------------
async function getLocation(){
  if(!navigator.geolocation) return null;
  return new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(p=>res(p.coords), e=>rej(e)));
}

async function getCountry(lat, lon){
  try{
    const r = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
    const data = await r.json();
    countryName = translateCountry(data.address.country_code||data.address.country);
    document.getElementById("status").innerText = countryName;
  } catch(e){document.getElementById("status").innerText = tt("status_not_started");}
}

async function getWeather(lat, lon){
  const apiKey = "YOUR_API_KEY"; // вставь свой ключ WeatherAPI
  try{
    const r = await fetch(`https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${lat},${lon}&lang=${langCode}`);
    const data = await r.json();
    document.getElementById("weather").innerText = `${data.current.temp_c}°C, ${data.current.condition.text}`;
  } catch(e){document.getElementById("weather").innerText = "---";}
}

async function updateLocationAndWeather(){
  try{
    lastCoords = await getLocation();
    if(lastCoords){
      await getCountry(lastCoords.latitude,lastCoords.longitude);
      await getWeather(lastCoords.latitude,lastCoords.longitude);
    }
  }catch(e){console.log(e);document.getElementById("status").innerText = tt("status_not_started");}
}

// -------------------
function startApp(){
  langCode = document.getElementById("langInput").value.toLowerCase();
  applyTranslations();
  updateLocationAndWeather();
}

// -------------------
function applyTranslations(){
  document.querySelectorAll("[data-i18n]").forEach(el=>el.innerText=tt(el.getAttribute("data-i18n")));
  document.getElementById("micState").innerText=isListening?tt("mic_on"):tt("mic_off");
  document.getElementById("micToggle").innerText=isListening?tt("mic_btn_on"):tt("mic_btn_off");
  renderReminders();
}

// -------------------
function addReminder(){
  const time=document.getElementById("reminderTime").value;
  const text=document.getElementById("reminderText").value;
  if(!time||!text) return;
  reminders.push({time,text});
  renderReminders();
}

function renderReminders(){
  const list=document.getElementById("reminderList");
  if(reminders.length===0){list.innerHTML='<span class="small">---</span>'; return;}
  list.innerHTML=reminders.map(r=>`<div class="reminder-item"><span>${r.time}</span><span class="reminder-text">${r.text}</span></div>`).join('');
}

// -------------------
setInterval(()=>{
  const now=new Date();
  const hhmm=now.toTimeString().substr(0,5);
  reminders.forEach(r=>{if(r.time===hhmm) alert(`Напоминание: ${r.text}`);});
},60000);

// -------------------
// Голосовое управление
function initVoice(){
  if(!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)){
    alert(tt("browser_no_stt"));
    return;
  }
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = langCode;
  recognition.continuous = true;
  recognition.interimResults = false;

  recognition.onresult = function(event){
    const transcript = event.results[event.results.length-1][0].transcript.trim().toLowerCase();
    document.getElementById("recognized").innerText=tt("recognized_prefix")+" "+transcript;
    handleVoiceCommand(transcript);
  };

  recognition.onend = function(){
    if(isListening) recognition.start();
  };
}

function toggleMic(){
  if(!recognition) initVoice();
  if(!recognition) return;
  if(isListening){recognition.stop(); isListening=false;}
  else {recognition.start(); isListening=true;}
  applyTranslations();
}

function handleVoiceCommand(text){
  if(text.includes("начать")||text.includes("start")||text.includes("indítás")||text.includes("почати")) startApp();
  if(text.includes("полиция")||text.includes("police")||text.includes("rendőrség")||text.includes("поліція")) alert(tt("police"));
  if(text.includes("пожар")||text.includes("fire")||text.includes("tűzoltóság")||text.includes("пожежна")) alert(tt("fire"));
  if(text.includes("скорая")||text.includes("ambulance")||text.includes("mentő")||text.includes("швидка")) alert(tt("ambulance"));
  if(text.includes("погода")||text.includes("weather")||text.includes("időjárás")||text.includes("погода")) updateLocationAndWeather();
  if(text.match(/напомни|remind|emlékeztess|нагадай/)){
    const m=text.match(/(\d{1,2}:\d{2})\s+(.+)/);
    if(m){reminders.push({time:m[1],text:m[2]}); renderReminders();}
  }
}

document.getElementById("micToggle").onclick=toggleMic;
</script>
</body>
</html>
